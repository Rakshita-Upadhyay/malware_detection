from flask import Flask, request, render_template, redirect, url_for
import joblib
import pickle
import numpy as np

app = Flask(__name__)

# Load the trained model and features
clf = joblib.load('classifier/classifier.pkl')
with open('classifier/features.pkl', 'rb') as f:
    features = pickle.load(f)

@app.route('/')
def index():
    return render_template('index.html', features=features)

@app.route('/predict', methods=['POST'])
def predict():
    form_data = request.form
    input_data = []

    try:
        for feature in features:
            input_data.append(float(form_data[feature]))
        input_data = np.array(input_data).reshape(1, -1)
        
        # Make prediction
        prediction = clf.predict(input_data)
        prediction_proba = clf.predict_proba(input_data)
        
        # Display the result
        return render_template('result.html', prediction=prediction[0], probability=prediction_proba[0][1])
    except KeyError as e:
        # Handle missing form data
        missing_feature = str(e).strip("'")
        return f"Error: Missing feature '{missing_feature}' in the form data.", 400

if __name__ == '__main__':
    app.run(debug=True)
